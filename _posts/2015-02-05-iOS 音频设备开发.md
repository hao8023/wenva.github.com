---
layout: post
title: "iOS 音频设备开发"
date: 2015-02-05
comments: false
---
# iOS 音频设备开发
February 5, 2015

#### 请求麦克风权限
<pre>
AVAudioSession *audioSession = [AVAudioSession sharedInstance];
if ([audioSession respondsToSelector:@selector(requestRecordPermission:)]) {
        [audioSession requestRecordPermission:^(BOOL available) {
            //等待用户响应
        }];
}
</pre>

#### 所有声音设备类型(kAudioSessionProperty_AudioRouteDescription)
* 输入类型(kAudioSession_AudioRouteKey_Inputs)
	<pre>
	const CFStringRef kAudioSessionInputRoute_LineIn; //输入线
	const CFStringRef kAudioSessionInputRoute_BuiltInMic; //内置麦克风
	const CFStringRef kAudioSessionInputRoute_HeadsetMic; //头戴麦克风
	const CFStringRef kAudioSessionInputRoute_BluetoothHFP; //蓝牙耳机
	const CFStringRef kAudioSessionInputRoute_USBAudio; //USB音频
	</pre>
* 输出类型
	<pre>
	const CFStringRef kAudioSessionOutputRoute_LineOut;//输出线
	const CFStringRef kAudioSessionOutputRoute_Headphones;
	const CFStringRef kAudioSessionOutputRoute_BluetoothHFP;
	const CFStringRef kAudioSessionOutputRoute_BluetoothA2DP;
	const CFStringRef kAudioSessionOutputRoute_BuiltInReceiver;
	const CFStringRef kAudioSessionOutputRoute_BuiltInSpeaker;
	const CFStringRef kAudioSessionOutputRoute_USBAudio;
	const CFStringRef kAudioSessionOutputRoute_HDMI;
	const CFStringRef kAudioSessionOutputRoute_AirPlay;
	</pre>
	
#### 检测音频输入变动
<pre>
...
AudioSessionInitialize(NULL, NULL, NULL, NULL);
OSStatus lStatus = AudioSessionAddPropertyListener(kAudioSessionProperty_AudioRouteChange, audioRouteChangeListenerCallback, nil);
...

static void audioRouteChangeListenerCallback (void *inUserData, AudioSessionPropertyID inPropertyID, UInt32 inPropertyValueSize, const void *inPropertyValue ) {
    CFStringRef route;
    UInt32 size = sizeof(route);
    AudioSessionGetProperty(kAudioSessionProperty_AudioRoute, &size, &route);
    NSLog(@"route=%@", route);
}
</pre>