---
layout: post
title: "线程局部存储"
date: 2015-04-08
comments: false
---
# 线程局部存储
April 8, 2015

## Overview
在移植linphone代码时，发现在注册SIP账号时，经常报如下错误:
<pre>
There is no object pool created in thread [xxxxx].Use belle_sip_object_pool_push() to create one. Unowned objects not unref'd will be leaked.
</pre>
经过调试发现是pthread_getspecific和pthread_setspecific出现了问题，原来想我只设置了一次pthread_setspecific，而发现有时pthread_getspecific获取的值是不一样的，当获取到得值为NULL，则报如上错误；而在其中我并没有进行pthread_key_delete和pthread_setspecific操作，为何相同key下，pthread_getspecific获取的值不一样呢？

仔细阅读了 thread-specific data management，发现这是一个线程局部存储，即同一线程内使用的，不同线程是不一样的，因此我将注册SIP账号放在**主线程**，就OK.

## TLS
线程局部存储TLS即Thread Local Storage，

