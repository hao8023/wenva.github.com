---
layout: post
title: "ping"
date: 2015-03-01
comments: false
---
# ping
March 1, 2015

<pre>
92 bytes from 192.168.60.147: Destination Host Unreachable
Vr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst
 4  5  00 5400 76e4   0 0000  3f  01 4571 192.168.1.108  192.168.60.151 
</pre>
* Vr - 版本（ipv4、ipv6）
* HL - IP头长度
* TOS - 服务类型字段: 服务类型(TOS)字段包括一个3 bit的优先权子字段(现在已被忽略)，4 bit的TOS子字段和1 bit未用位但必须置0。4 bit的TOS子字段分别代表:最小时延、最大吞吐量、最高可靠性和最
小费用。4 bit中只能设置其中1 bit。如果所有4 bit均为0,那么就意味着是一般服务。
* Len - IP数据报长度
* ID - 表示数据报，通常每发送一份报文它的值就会加1
* Flg - 分段偏移(Fragment offset)域的高3位，比特0是保留的，必须为0；比特1是“更多分片”(MF -- More Fragment)标志。除了最后一片外，其他每个组成数据报的片都要把该比特置1。比特2是“不分片”(DF -- DonDon't Fragment)标志,如果将这一比特置1，IP将不对数据报进行分片,这时如果有需要进行分片的数据报到来，会丢弃此数据报并发送一个ICMP差错报文给起始端。
* off - 分段偏移(Fragment offset)域的低13位
* TTL - 存活时间, TTL是IP协议包中的一个值，它告诉网络路由器包在网络中的时间是否太长而应被丢弃。 即经过的最大节点数目
* Pro - 协议族
* cks - 校验码
* Src - 源
* Dst - 目的

ping 使用的是[ICMP](http://www.ietf.org/rfc/rfc792.txt)协议，ICMP是（Internet Control Message Protocol）Internet控制报文协议。它是TCP/IP协议族的一个子协议，用于在IP主机、路由器之间传递控制消息。控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。
![image](http://g.hiphotos.baidu.com/baike/s%3D250/sign=4e8661dcf8f2b211e02e824bfa816511/ae51f3deb48f8c54ca50c28039292df5e1fe7f99.jpg)

|TYPE|CODE|Description|Query|Error
|:--|:--|:--|:--|:--
|0|0|Echo Reply——回显应答（Ping应答）|x|	　
|3|0|Network Unreachable——网络不可达||x
|3|1|Host Unreachable——主机不可达||x
|3|2|Protocol Unreachable——协议不可达||x
|3|3|Port Unreachable——端口不可达||x
|3|4|Fragmentation needed but no frag. bit set——需要进行分片但设置不分片比特||x
|3|5|Source routing failed——源站选路失败||x
|3|6|Destination network unknown——目的网络未知||x
|3|7|Destination host unknown——目的主机未知||x
|3|8|Source host isolated (obsolete)——源主机被隔离（作废不用）||x
|3|9|Destination network administratively prohibited——目的网络被强制禁止||x
|3|10|Destination host administratively prohibited——目的主机被强制禁止||x
|3|11|Network unreachable for TOS——由于服务类型TOS，网络不可达||x
|3|12|Host unreachable for TOS——由于服务类型TOS，主机不可达||x
|3|13|Communication administratively prohibited by filtering——由于过滤，通信被强制禁止||x
|3|14|Host precedence violation——主机越权||x
|3|15|Precedence cutoff in effect——优先中止生效||x
|4|0|Source quench——源端被关闭（基本流控制）	　	　
|5|0|Redirect for network——对网络重定向	　	　
|5|1|Redirect for host——对主机重定向	　	　
|5|2|Redirect for TOS and network——对服务类型和网络重定向
|5|3|Redirect for TOS and host——对服务类型和主机重定向
|8|0|Echo request——回显请求（Ping请求）|x|	　
|9|0|Router advertisement——路由器通告	　	　
|10|0|Route solicitation——路由器请求	　	　
|11|0|TTL equals 0 during transit——传输期间生存时间为0||x
|11|1|TTL equals 0 during reassembly——在数据报组装期间生存时间为0||x
|12|0|IP header bad (catchall error)——坏的IP首部（包括各种差错）||x
|12|1|Required options missing——缺少必需的选项||x
|13|0|Timestamp request (obsolete)——时间戳请求（作废不用）|x　
|14||Timestamp reply (obsolete)——时间戳应答（作废不用）|x　
|15|0|Information request (obsolete)——信息请求（作废不用）|x
|16|0|Information reply (obsolete)——信息应答（作废不用）|x
|17|0|Address mask request——地址掩码请求|x
|18|0|Address mask reply——地址掩码应答	　	　

##### 用ping测试网络连通
* ifconifg查看网络设置
* ping 127.0.0.1 检查本地TCP/IP协议是否OK
* ping 本机IP地址，检查本机网卡是否OK
* ping 网关，检查本地局域网是否OK
* ping DNS，检查是否可以进行域名解析
* ping 远程IP，检查是否可以连接Internet

##### .0省略
* ping 127.0.0.1 = ping 127.1
* ping 127.0.1.1 != ping 127.1.1