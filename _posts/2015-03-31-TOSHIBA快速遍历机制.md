---
layout: post
title: "TOSHIBA快速遍历机制"
date: 2015-03-31
comments: false
---
# TOSHIBA快速遍历机制
March 31, 2015
### 0. 数据库设计
* 0.1 表设计
	* 全路径(主键)
	* 父目录全路径 
	* 文件名 
	* 修改时间 
	* 文件大小
	* 文件类型（视频、音乐、图片、文档）
	* 是否文件夹
	* 是否已遍历

### 1. 未遍历完成
* 1.1 遍历所有目录（其中/为必备目录），并获取其修改时间（PROPFIND Depth=0）
* 1.2 从数据库中取出“是否已遍历”字段
* 1.3 判断“是否已遍历”
	* 1.3.1 TRUE
		* 动作参考2.2
	* 1.3.2 FALSE
		* 1.3.2.1 遍历该目录
		* 1.3.2.2 加入所有文件及文件夹到数据库(PROPFIND Depth=1)
		* 1.3.2.3 标示该文件夹为已遍历

### 2. 已遍历完成
* 2.1 遍历所有目录，并获取其修改时间（PROPFIND Depth=0）
* 2.2 比较其修改时间与上一次数据库中的修改时间是否相同
	* 2.2.1 相同
		* 2.2.1.1 无动作
	* 2.2.2 不同 
		* 2.2.2.1 获取该目录下所有文件和文件夹 
		* 2.2.2.2 从数据库删除该目录下的所有文件（不包括文件夹）
		* 2.2.2.3 把2.2.2.1获取到的文件加入到数据库
		* 2.2.2.4 判断2.2.2.1获取到的文件夹是否已存在，若不存在则加入，否则无动作
	* 2.2.3 空（不存在）
		* 2.2.3.1 从数据库中删除此目录及此目录下的所有文件和文件夹（包含孙子节点）

### 问题点
* 文件修改时间无法更新

