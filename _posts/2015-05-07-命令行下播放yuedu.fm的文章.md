---
layout: post
title: "命令行下播放yuedu.fm的文章"
date: 2015-05-07
comments: false
categories: 技巧
---
一直喜欢yuedu.fm里的文章，本来想弄个APP，结果API不开放，后来偶然间发现网页中竟然带有mp3路径的字段，这不是给我留漏洞，此时若不钻，更待何时，通过curl、awk就能获取到MP3的url，再利用mplayer，就可以在命令下播放，再加上随机函数，就可以随机播放yuedu.fm的文章，下面是shell的脚本.
<pre>
#!/bin/bash
base_url="http://yuedu.fm"

function rand() {
    min=$1  
    max=$(($2-$min+1))  
    num=$(($RANDOM+1000000000))
    echo $(($num%$max+$min))  
}

function get_url() {
    uri=`curl $base_url/article/$1/ | awk -F: '/mp3:/{print $2}'| sed 's/\"//g'`
    echo "$base_url$uri"
}

`pkill mplayer`

while true
do

on=`ps|awk '/mplayer/{print $0}'|grep mp3`

if [ -z "$on" ]; then
    url=$(get_url $(rand 1 1000))
    echo "Play:$url"
    `mplayer $url`&
fi

sleep 10

done
</pre>
